This problem came out to be a lot easier than I thought it would be. Some constraints make the problem a lot easier than first anticipated. There are some tricky things in the problem definition, too.

My typescript implementation passed many c++ solutions and solutions in other languages in speed, and became 2nd fastest overall. I'm happy with the result.